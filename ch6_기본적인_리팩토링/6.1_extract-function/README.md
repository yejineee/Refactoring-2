#리팩토링

# 6.1 함수 추출하기 (Extract Function)

**TOC**
- 배경
	- 코드를 언제 독립된 함수로 묶어야 하는가
- 절차
- 예시
	- (ex.1) 유효범위를 벗어나는 함수가 없는 경우
	- (ex.2) 지역 변수를 사용하는 경우
	- (ex.3) 지역 변수의 값을 변경하는 경우

  

## 배경
- 코드 조각이 **무슨 일을 하느냐**를 파악한 후, 독립된 함수로 추출하고, 목적에 맞는 이름을 붙인다.

### 코드를 언제 독립된 함수로 묶어야 하는가
- 기준: `목적과 구현을 분리`
	- 코드가 무슨 일을 하는지 모르겠다?
	- => 함수로 만들고, '무슨 일' 즉 목적에 맞는 이름을 붙여라.
	- => 코드가 무슨 일을 하는지를 바로 알 수 있고, 그 구현에 대해서는 신경쓰지 않아도 된다.

- 짧은 함수의 길이도 괜찮을까?
	- 함수의 길이는 짧아도 된다. 심지어 한 줄짜리 함수도 괜찮다! **코드의 목적을 강조하는 것이 더 중요**하다.
	- 함수의 목적을 드러내는 이름 짓기가 더 중요하다.


## 절차

1. 함수 이름 정하기
	- 함수를 새로 만들고, 목적을 잘 드러내는 이름을 붙인다.
	- 코드가 함수 호출문 하나처럼 매우 간단하더라도, <u>목적이 더 잘 드러나는 이름을 붙일 수 있다면</u> 함수로 추출한다. 
	- 중첩 함수를 지원하는 언어를 사용한다면, 추출한 함수를 원래 함수 안에 중첩시킨다. 유효범위를 벗어난 변수 처리 작업을 줄이기 위함이다. 원래 함수 바깥으로 꺼내야 할 때가 오면, `함수 옮기기`(8.1절)를 적용하면 된다.
2. 추출할 코드를 새 함수에 넣기
3. 새 함수에 매개변수 전달하기
	- 추출한 코드중 원본 함수의 지역 변수를 참조하거나, 추출한 함수의 유효범위를 벗어나는 변수가 있다면, **매개변수로 전달**한다.
	- 1번에서 말했듯이, 원본 함수의 중첩함수로 추출하면, 이런 문제가 생기지 않는다.
	- 추출한 코드 안에서 매개변수의 값을 변경해야 한다면, 임시 변수에 값을 변경하고 그 값을 반환하도록 한다. 
4. 컴파일하기
5. 원본함수에서 새롭게 만든 함수를 호출하기
6. 테스트하기
7. 다른 코드에서 추출한 함수를 호출시킬 수 있는지 검토하기

## 예시
### (ex.1) 유효 범위를 벗어나는 변수가 없는 경우
- printDetails()가 printOwing()안의 **중첩 함수로 정의**하면, printDetails는 printOwing에 정의된 모든 변수를 접근할 수 있다. 
- 중첩함수를 지원하지 않는 언어에서는, 함수를 최상위 레벨로 추출해야 한다. 이 때에는 원본 함수 내에서만 접근할 수 있는 변수들에 더 신경을 써야 한다.

### (ex.2) 지역 변수의 값을 사용하는 경우
- 지역 변수를 사용하지만, 다른 값을 다시 대입하지는 않는 경우엔, **지역 변수들을 매개변수로 넘긴다.**
	- 지역변수가 배열, 레코드, 객체와 같은 데이터 구조이면, 똑같이 매개변수로 넘기고, 값을 수정한다.

### (ex.3) 지역 변수의 값을 변경하는 경우
- 매개변수에 값을 대입해야 한다면, **임시 변수를 만들어서 그 변수에 값**을 대입하도록 한다.
- 임시 변수가 새로 만든 함수 안에서만 쓰인다면, 이 변수는 그 함수 안에만 존재한다. 만약 변수가 초기화되는 지점과 사용하는 지점이 떨어져있다면, `문장 슬라이드`(8.6절)로 변수를 한 곳에 모으자.
```js
let outstanding = 0; // ✨ 맨 위에 있던 선언문을 이 위치로 이동
for (const o of invoice.orders) {
	outstanding += o.amount;
}
```
-  임시 변수가 새로 만든 함수 밖에서도 쓰인다면, **그 변수를 반환**해야 한다.
```js
function calculateOutstanding(invoice) {
	let outstanding = 0;
	for (const o of invoice.orders) {
		outstanding += o.amount;
	}
	
	// ✨ 수정된 값 반환
	return outstanding;
}
```

### 값을 반환할 함수가 여러 개라면?
- 저자는 함수가 값 하나만 반환하는 방식을 선호하므로, 각각을 반호나하는 함수를 여러 개 만들 것을 제안한다.
- 꼭 여러 값을 반환해야 한다면, 레코드로 반환한다.
- `임시 변수를 질의 함수로 바꾸기나`(7.4절), `변수를 쪼개는 식`(9.1절)으로 처리하는게 나을 수도 있다.